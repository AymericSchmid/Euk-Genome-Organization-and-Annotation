#!/usr/bin/env bash
# =============================================================================
# Script: 05_a_TE_divergence.slurm
# Purpose: Calculate TE divergence landscape from RepeatMasker output
#          This generates data for plotting TE age distribution
# =============================================================================

#SBATCH --cpus-per-task=4
#SBATCH --mem-per-cpu=16G
#SBATCH --time=1:00:00
#SBATCH --partition=pibu_el8
#SBATCH --job-name=TE_divergence
#SBATCH --output=/data/users/aschmid/Euk-Genome-Organization-and-Annotation/output/TE_divergence_output_%j.o
#SBATCH --error=/data/users/aschmid/Euk-Genome-Organization-and-Annotation/output/TE_divergence_error_%j.o

WORK_DIR=/data/users/aschmid/Euk-Genome-Organization-and-Annotation
OUT_DIR=$WORK_DIR/divergence
REPEATMASKER_FILE=$WORK_DIR/TE_annotation/EDTA/assembly.fa.mod.EDTA.anno/assembly.fa.mod.out
PERL_SCRIPT=$WORK_DIR/scripts/perlScripts/parseRM.pl
PERL_MODULE=BioPerl/1.7.8-GCCcore-10.3.0

# Create Output Directory
mkdir -p $OUT_DIR

module add $PERL_MODULE

# Run parseRM.pl to generate divergence landscape data
# -i: input RepeatMasker .out file
# -l 50,1: generate landscape with max divergence 50%, bin size 1%
# -v: verbose mode
perl $PERL_SCRIPT -i $REPEATMASKER_FILE -l 50,1 -v

# Move all landscape files generated by parseRM.pl to the output directory
mv $REPEATMASKER_FILE.landscape* $OUT_DIR